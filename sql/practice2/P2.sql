--Creación de tablas

--drop table actuacion;

--drop table peliculas;

--drop table actores;

CREATE TABLE actores (
  oid decimal(10,0) NOT NULL,
  nom char(100) NOT NULL,
  sexo char(1) NOT NULL,
  PRIMARY KEY (oid)
);

CREATE TABLE peliculas (
  oid decimal(10,0) NOT NULL,
  titulo char(200) NOT NULL,
  anyo decimal(4,0) NOT NULL,
  PRIMARY KEY (oid)
);

CREATE TABLE actuacion (
  actor decimal(10,0) NOT NULL,
  peli decimal(10,0) NOT NULL,
  papel char(100) NOT NULL,
  PRIMARY KEY (actor,peli,papel)
);

-------------------

create table MY_PLAN_TABLE (
        statement_id       varchar2(30),
        plan_id            number,
        timestamp          date,
        remarks            varchar2(4000),
        operation          varchar2(30),
        options            varchar2(255),
        object_node        varchar2(128),
        object_owner       varchar2(30),
        object_name        varchar2(30),
        object_alias       varchar2(65),
        object_instance    numeric,
        object_type        varchar2(30),
        optimizer          varchar2(255),
        search_columns     number,
        id                 numeric,
        parent_id          numeric,
        depth              numeric,
        position           numeric,
        cost               numeric,
        cardinality        numeric,
        bytes              numeric,
        other_tag          varchar2(255),
        partition_start    varchar2(255),
        partition_stop     varchar2(255),
        partition_id       numeric,
        other              long,
        distribution       varchar2(30),
        cpu_cost           numeric,
        io_cost            numeric,
        temp_space         numeric,
        access_predicates  varchar2(4000),
        filter_predicates  varchar2(4000),
        projection         varchar2(4000),
        time               numeric,
        qblock_name        varchar2(30),
        other_xml          clob
);

--EJERCICIO 1
--2)
CREATE INDEX IDX_SEXO ON ACTORES (SEXO);
CREATE INDEX IDX_ANYO ON PELICULAS (ANYO);

--3)
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'ACTORES', cascade=>true, force=>true);
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'ACTUACION', cascade=>true, force=>true);
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'PELICULAS', cascade=>true, force=>true);

exec dbms_stats.gather_index_stats( ownname=>'GIISGBD401', indname=>'IDX_SEXO', force =>true);
exec dbms_stats.gather_index_stats( ownname=>'GIISGBD401', indname=>'IDX_ANYO', force =>true);

--4)
----a)
SELECT TABLE_NAME, NUM_ROWS, BLOCKS, AVG_ROW_LEN FROM USER_TABLES;
----b)
SELECT TABLE_NAME, COLUMN_NAME, NUM_DISTINCT, LOW_VALUE, HIGH_VALUE, NUM_NULLS, AVG_COL_LEN, HISTOGRAM FROM USER_TAB_COLUMNS;
----c)
SELECT INDEX_NAME, TABLE_NAME, BLEVEL, LEAF_BLOCKS, DISTINCT_KEYS, AVG_LEAF_BLOCKS_PER_KEY, AVG_DATA_BLOCKS_PER_KEY, CLUSTERING_FACTOR, NUM_ROWS FROM USER_INDEXES;

--5)
--Los valores de LOW_VALUE y HIGH_VALUE de la tabla USER_TAB_COLUMNS de algunas tablas son muy grandes, como NOM de ACTORES o PAPEL de ACTUACION.
--A través de la información de NUM_DISTINCT de SEXO de ACTORES, recogido de USER_TAB_COLUMNS, sabemos que todos los registros tienen el mismo valor en esa columna, ya que el NUM_DISTINCT es 1.
--
--SELECT count(*) FROM ACTORES;
--SELECT count(*) FROM ACTUACION;
--SELECT count(*) FROM PELICULAS;
--
--Tras realizar las anteriores consultas, podemos afirmar que los resultados obtenidos coinciden con el nº de filas en cada tabla.
--

--6)
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'ACTORES', cascade_columns=>true, cascade_indexes=>true);
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'ACTUACION', cascade_columns=>true, cascade_indexes=>true);
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'PELICULAS', cascade_columns=>true, cascade_indexes=>true);

exec dbms_stats.delete_index_stats( ownname=>'GIISGBD401', indname=>'IDX_SEXO', force=>true);
exec dbms_stats.delete_index_stats( ownname=>'GIISGBD401', indname=>'IDX_ANYO', force=>true);

DROP INDEX IDX_SEXO;
DROP INDEX IDX_ANYO;

--7)
--Los nº de filas de cada columna siguen siendo correctos.
--Los valores de LOW_VALUE y HIGH_VALUE siguen siendo muy altos.

--EJERCICIO 2
SET AUTOTRACE ON EXPLAIN;
SET TIMING ON EXPLAIN;

exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'ACTORES', cascade_columns=>true, cascade_indexes=>true);
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'ACTUACION', cascade_columns=>true, cascade_indexes=>true);
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'PELICULAS', cascade_columns=>true, cascade_indexes=>true);

--1
SELECT *
FROM PELICULAS
WHERE ANYO > 1992;

/*
-------------------------------------------------------------------------------
| Id  | Operation         | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |           |  1879 |   418K|   102   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| PELICULAS |  1879 |   418K|   102   (0)| 00:00:01 |
-------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("ANYO">1992)
 
Note
-----
   - dynamic statistics used: dynamic sampling (level=2)

Transcurrido: 00:00:02.361
*/

SELECT *
FROM PELICULAS P, ACTUACION ACT
WHERE P.OID = ACT.PELI
AND ANYO > 1992;

/*
--------------------------------------------------------------------------------------
| Id  | Operation             | Name         | Rows  | Bytes | Cost (%CPU)| Time     |
--------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT      |              |  2337 |   812K|   170   (0)| 00:00:01 |
|*  1 |  HASH JOIN            |              |  2337 |   812K|   170   (0)| 00:00:01 |
|*  2 |   TABLE ACCESS FULL   | PELICULAS    |  1879 |   418K|   102   (0)| 00:00:01 |
|   3 |   INDEX FAST FULL SCAN| SYS_C0067129 | 12154 |  1519K|    68   (0)| 00:00:01 |
--------------------------------------------------------------------------------------
 

PLAN_TABLE_OUTPUT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------
 
   1 - access("P"."OID"="ACT"."PELI")
   2 - filter("ANYO">1992)
 
Note
-----
   - dynamic statistics used: dynamic sampling (level=2)
   - SQL plan baseline "SQL_PLAN_5rbfp05f7uk3m7c4a039a" used for this statement

Transcurrido: 00:00:03.265
*/

SELECT P.*
FROM ACTORES A, ACTUACION X, PELICULAS P
WHERE A.NOM = 'Loy, Myrna'
AND A.OID = X.ACTOR
AND P.OID = X.PELI;

/*
---------------------------------------------------------------------------------------------
| Id  | Operation                    | Name         | Rows  | Bytes | Cost (%CPU)| Time     |
---------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT             |              |     9 |  3321 |    80   (0)| 00:00:01 |
|   1 |  NESTED LOOPS                |              |     9 |  3321 |    80   (0)| 00:00:01 |
|   2 |   NESTED LOOPS               |              |     9 |  3321 |    80   (0)| 00:00:01 |
|   3 |    NESTED LOOPS              |              |     9 |  1269 |    71   (0)| 00:00:01 |
|*  4 |     TABLE ACCESS FULL        | ACTORES      |     3 |   345 |    68   (0)| 00:00:01 |
|*  5 |     INDEX RANGE SCAN         | SYS_C0067129 |     3 |    78 |     1   (0)| 00:00:01 |

PLAN_TABLE_OUTPUT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|*  6 |    INDEX UNIQUE SCAN         | SYS_C0067125 |     1 |       |     0   (0)| 00:00:01 |
|   7 |   TABLE ACCESS BY INDEX ROWID| PELICULAS    |     1 |   228 |     1   (0)| 00:00:01 |
---------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   4 - filter("A"."NOM"='Loy, Myrna')
   5 - access("A"."OID"="X"."ACTOR")
   6 - access("P"."OID"="X"."PELI")
 

PLAN_TABLE_OUTPUT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Note
-----
   - dynamic statistics used: dynamic sampling (level=2)
   - this is an adaptive plan

Transcurrido: 00:00:01.210
*/

--2
/*
El número de filas seleccionadas no coincide con el valor que se obtiene en "rows".
*/

--3
/*Maneras en que funciona el muestreo dinámico
Hay dos formas de utilizar el muestreo dinámico:

El parámetro OPTIMIZER_DYNAMIC_SAMPLING se puede establecer en el nivel de instancia de la 
base de datos y también se puede invalidar en el nivel de sesión con el comando ALTER SESSION.
eL PARÁMETRO de consulta DYNAMIC_SAMPLING se puede agregar a consultas específicas.*/

--4
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'ACTORES', cascade=>true, force=>true);
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'ACTUACION', cascade=>true, force=>true);
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'PELICULAS', cascade=>true, force=>true);

--5
SELECT *
FROM PELICULAS
WHERE ANYO > 1992;
/*
-------------------------------------------------------------------------------
| Id  | Operation         | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |           |  1999 |   409K|   102   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| PELICULAS |  1999 |   409K|   102   (0)| 00:00:01 |
-------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("ANYO">1992)
*/

SELECT *
FROM PELICULAS P, ACTUACION ACT
WHERE P.OID = ACT.PELI
AND ANYO > 1992;

/*
--------------------------------------------------------------------------------------
| Id  | Operation             | Name         | Rows  | Bytes | Cost (%CPU)| Time     |
--------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT      |              |  2235 |   700K|   155   (0)| 00:00:01 |
|*  1 |  HASH JOIN            |              |  2235 |   700K|   155   (0)| 00:00:01 |
|*  2 |   TABLE ACCESS FULL   | PELICULAS    |  1999 |   409K|   102   (0)| 00:00:01 |
|   3 |   INDEX FAST FULL SCAN| SYS_C0067129 | 12500 |  1354K|    53   (0)| 00:00:01 |
--------------------------------------------------------------------------------------
 

PLAN_TABLE_OUTPUT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------
 
   1 - access("P"."OID"="ACT"."PELI")
   2 - filter("ANYO">1992)
*/

SELECT P.*
FROM ACTORES A, ACTUACION X, PELICULAS P
WHERE A.NOM = 'Loy, Myrna'
AND A.OID = X.ACTOR
AND P.OID = X.PELI;

/*
---------------------------------------------------------------------------------------------
| Id  | Operation                    | Name         | Rows  | Bytes | Cost (%CPU)| Time     |
---------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT             |              |     1 |   326 |    70   (0)| 00:00:01 |
|   1 |  NESTED LOOPS                |              |     1 |   326 |    70   (0)| 00:00:01 |
|   2 |   NESTED LOOPS               |              |     1 |   326 |    70   (0)| 00:00:01 |
|   3 |    NESTED LOOPS              |              |     1 |   116 |    69   (0)| 00:00:01 |
|*  4 |     TABLE ACCESS FULL        | ACTORES      |     1 |   106 |    68   (0)| 00:00:01 |
|*  5 |     INDEX RANGE SCAN         | SYS_C0067129 |     1 |    10 |     1   (0)| 00:00:01 |

PLAN_TABLE_OUTPUT                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|*  6 |    INDEX UNIQUE SCAN         | SYS_C0067125 |     1 |       |     0   (0)| 00:00:01 |
|   7 |   TABLE ACCESS BY INDEX ROWID| PELICULAS    |     1 |   210 |     1   (0)| 00:00:01 |
---------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   4 - filter("A"."NOM"='Loy, Myrna')
   5 - access("A"."OID"="X"."ACTOR")
   6 - access("P"."OID"="X"."PELI")
*/

/*
No se aprecian cambios significativos aparte de variaciones en los valores de la columna "row".
*/

--EJERCICIO 3
--1
SET AUTOTRACE OFF;
SET TIMING OFF;

exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'ACTORES', cascade_columns=>true, cascade_indexes=>true, force=>true);
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'ACTUACION', cascade_columns=>true, cascade_indexes=>true, force=>true);
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'PELICULAS', cascade_columns=>true, cascade_indexes=>true, force=>true);

EXPLAIN PLAN FOR 
SELECT * FROM PELICULAS WHERE ANYO=1960;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-------------------------------------------------------------------------------
| Id  | Operation         | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |           |    70 | 15960 |   102   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| PELICULAS |    70 | 15960 |   102   (0)| 00:00:01 |
-------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("ANYO"=1960)
*/

EXPLAIN PLAN FOR 
SELECT * FROM PELICULAS WHERE ANYO<1960;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-------------------------------------------------------------------------------
| Id  | Operation         | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |           |  4058 |   903K|   102   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| PELICULAS |  4058 |   903K|   102   (0)| 00:00:01 |
-------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("ANYO"<1960)
*/

EXPLAIN PLAN FOR 
SELECT * FROM PELICULAS WHERE ANYO>1960;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-------------------------------------------------------------------------------
| Id  | Operation         | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |           |  6918 |  1540K|   102   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| PELICULAS |  6918 |  1540K|   102   (0)| 00:00:01 |
-------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("ANYO">1960)
*/

EXPLAIN PLAN FOR 
SELECT * FROM PELICULAS WHERE ANYO<>1960;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-------------------------------------------------------------------------------
| Id  | Operation         | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |           | 10977 |  2444K|   102   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| PELICULAS | 10977 |  2444K|   102   (0)| 00:00:01 |
-------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("ANYO"<>1960)
*/

--2
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'ACTORES', cascade=>true, force=>true);
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'ACTUACION', cascade=>true, force=>true);
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'PELICULAS', cascade=>true, force=>true);

EXPLAIN PLAN FOR 
SELECT * FROM PELICULAS WHERE ANYO=1960;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-------------------------------------------------------------------------------
| Id  | Operation         | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |           |    89 | 18690 |   102   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| PELICULAS |    89 | 18690 |   102   (0)| 00:00:01 |
-------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("ANYO"=1960)
*/

EXPLAIN PLAN FOR 
SELECT * FROM PELICULAS WHERE ANYO<1960;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-------------------------------------------------------------------------------
| Id  | Operation         | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |           |  3989 |   818K|   102   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| PELICULAS |  3989 |   818K|   102   (0)| 00:00:01 |
-------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("ANYO"<1960)
*/

EXPLAIN PLAN FOR 
SELECT * FROM PELICULAS WHERE ANYO>1960;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-------------------------------------------------------------------------------
| Id  | Operation         | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |           |  7105 |  1457K|   102   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| PELICULAS |  7105 |  1457K|   102   (0)| 00:00:01 |
-------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("ANYO">1960)
*/

EXPLAIN PLAN FOR 
SELECT * FROM PELICULAS WHERE ANYO<>1960;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-------------------------------------------------------------------------------
| Id  | Operation         | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |           | 11093 |  2274K|   102   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| PELICULAS | 11093 |  2274K|   102   (0)| 00:00:01 |
-------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("ANYO"<>1960)
*/

/*

Al utilizar estadísticas se puede observar un aumento en los valores de la columna "rows". Sin embargo, el coste es el mismo.

*/

--3

exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'ACTORES', cascade_columns=>true, cascade_indexes=>true, force=>true);
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'ACTUACION', cascade_columns=>true, cascade_indexes=>true, force=>true);
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'PELICULAS', cascade_columns=>true, cascade_indexes=>true, force=>true);

exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'ACTORES', cascade=>true, force=>true);
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'ACTUACION', cascade=>true, force=>true);
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'PELICULAS', cascade=>true, force=>true);

CREATE INDEX IDX_ANYO ON PELICULAS(ANYO);

exec dbms_stats.gather_index_stats( ownname=>'GIISGBD401', indname=>'IDX_ANYO', force =>true);

--4

EXPLAIN PLAN FOR 
SELECT * FROM PELICULAS WHERE ANYO=1960;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-------------------------------------------------------------------------------------------------
| Id  | Operation                           | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                    |           |    89 | 18690 |    69   (0)| 00:00:01 |
|   1 |  TABLE ACCESS BY INDEX ROWID BATCHED| PELICULAS |    89 | 18690 |    69   (0)| 00:00:01 |
|*  2 |   INDEX RANGE SCAN                  | IDX_ANYO  |    89 |       |     1   (0)| 00:00:01 |
-------------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------
 
   2 - access("ANYO"=1960)
*/

EXPLAIN PLAN FOR 
SELECT count(*) FROM PELICULAS WHERE ANYO<1960;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-------------------------------------------------------------------------------
| Id  | Operation         | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |           |  3989 |   818K|   102   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| PELICULAS |  3989 |   818K|   102   (0)| 00:00:01 |
-------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("ANYO"<1960)
*/

EXPLAIN PLAN FOR 
SELECT * FROM PELICULAS WHERE ANYO>1960;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-------------------------------------------------------------------------------
| Id  | Operation         | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |           |  7105 |  1457K|   102   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| PELICULAS |  7105 |  1457K|   102   (0)| 00:00:01 |
-------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("ANYO">1960)
*/

EXPLAIN PLAN FOR 
SELECT * FROM PELICULAS WHERE ANYO<>1960;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-------------------------------------------------------------------------------
| Id  | Operation         | Name      | Rows  | Bytes | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |           | 11093 |  2274K|   102   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| PELICULAS | 11093 |  2274K|   102   (0)| 00:00:01 |
-------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("ANYO"<>1960)
*/

--5
--Se puede observar una diferencia en la primera consulta, que sí que utliza el índice en su plan de ejecucción, 
--ya que la comparación se realiza con un valor determinado: "=1980", a diferencia del resto de consultas: "<, >, <>".

/*
El plan de la primera consulta dice que selecciona 13 filas, pero si se ejecuta un count(*) en la consulta, se obtienen 22.
El plan de la segunda consulta dice que selecciona 13 filas, pero si se ejecuta un count(*) en la consulta, se obtienen 25.
El plan de la tercera consulta dice que selecciona 13 filas, pero si se ejecuta un count(*) en la consulta, se obtienen 58.
El plan de la cuarta consulta dice que selecciona 13 filas, pero si se ejecuta un count(*) en la consulta, se obtienen 83.
*/

--6
exec dbms_stats.delete_index_stats( ownname=>'GIISGBD401', indname=>'IDX_ANYO', force=>true);
DROP INDEX IDX_ANYO;

--EJERCICIO 4
--1

TRUNCATE TABLE ACTORES;
TRUNCATE TABLE ACTUACION;
TRUNCATE TABLE PELICULAS;

--CARGAR DATOS

exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'ACTORES', cascade_columns=>true, cascade_indexes=>true, force=>true);
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'ACTUACION', cascade_columns=>true, cascade_indexes=>true, force=>true);
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'PELICULAS', cascade_columns=>true, cascade_indexes=>true, force=>true);

exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'ACTORES', cascade=>true, force=>true);
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'ACTUACION', cascade=>true, force=>true);
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'PELICULAS', cascade=>true, force=>true);

--2

EXPLAIN PLAN FOR 
SELECT * FROM ACTORES WHERE SEXO = 'H';

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-----------------------------------------------------------------------------
| Id  | Operation         | Name    | Rows  | Bytes | Cost (%CPU)| Time     |
-----------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |         |  1382 |   145K|    13   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| ACTORES |  1382 |   145K|    13   (0)| 00:00:01 |
-----------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("SEXO"='H')
*/

EXPLAIN PLAN FOR 
SELECT COUNT(*) FROM ACTORES WHERE SEXO = 'H';

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
------------------------------------------------------------------------------
| Id  | Operation          | Name    | Rows  | Bytes | Cost (%CPU)| Time     |
------------------------------------------------------------------------------
|   0 | SELECT STATEMENT   |         |     1 |     2 |    13   (0)| 00:00:01 |
|   1 |  SORT AGGREGATE    |         |     1 |     2 |            |          |
|*  2 |   TABLE ACCESS FULL| ACTORES |  1382 |  2764 |    13   (0)| 00:00:01 |
------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------
 
   2 - filter("SEXO"='H')
*/

--3

CREATE INDEX IDX_SEXO ON ACTORES (SEXO);
exec dbms_stats.gather_index_stats( ownname=>'GIISGBD401', indname=>'IDX_SEXO', force =>true);

--4
EXPLAIN PLAN FOR 
SELECT * FROM ACTORES WHERE SEXO = 'H';

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-----------------------------------------------------------------------------
| Id  | Operation         | Name    | Rows  | Bytes | Cost (%CPU)| Time     |
-----------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |         |  1382 |   145K|    13   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| ACTORES |  1382 |   145K|    13   (0)| 00:00:01 |
-----------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("SEXO"='H')
*/

EXPLAIN PLAN FOR 
SELECT COUNT(*) FROM ACTORES WHERE SEXO = 'H';

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
------------------------------------------------------------------------------
| Id  | Operation         | Name     | Rows  | Bytes | Cost (%CPU)| Time     |
------------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |          |     1 |     2 |     3   (0)| 00:00:01 |
|   1 |  SORT AGGREGATE   |          |     1 |     2 |            |          |
|*  2 |   INDEX RANGE SCAN| IDX_SEXO |  1382 |  2764 |     3   (0)| 00:00:01 |
------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
---------------------------------------------------
 
   2 - access("SEXO"='H')
*/

--5

exec dbms_stats.delete_index_stats( ownname=>'GIISGBD401', indname=>'IDX_SEXO', force=>true);
DROP INDEX IDX_SEXO;
CREATE BITMAP INDEX IDX_SEXO ON ACTORES(SEXO);
exec dbms_stats.gather_index_stats( ownname=>'GIISGBD401', indname=>'IDX_SEXO', force =>true);

--6
EXPLAIN PLAN FOR 
SELECT * FROM ACTORES WHERE SEXO = 'H';

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-----------------------------------------------------------------------------
| Id  | Operation         | Name    | Rows  | Bytes | Cost (%CPU)| Time     |
-----------------------------------------------------------------------------
|   0 | SELECT STATEMENT  |         |  1382 |   145K|    13   (0)| 00:00:01 |
|*  1 |  TABLE ACCESS FULL| ACTORES |  1382 |   145K|    13   (0)| 00:00:01 |
-----------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
   1 - filter("SEXO"='H')
*/

EXPLAIN PLAN FOR 
SELECT COUNT(*) FROM ACTORES WHERE SEXO = 'H';

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
------------------------------------------------------------------------------------------
| Id  | Operation                     | Name     | Rows  | Bytes | Cost (%CPU)| Time     |
------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT              |          |     1 |     2 |     1   (0)| 00:00:01 |
|   1 |  SORT AGGREGATE               |          |     1 |     2 |            |          |
|   2 |   BITMAP CONVERSION COUNT     |          |  1382 |  2764 |     1   (0)| 00:00:01 |
|*  3 |    BITMAP INDEX FAST FULL SCAN| IDX_SEXO |       |       |            |          |
------------------------------------------------------------------------------------------
 

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Predicate Information (identified by operation id):
---------------------------------------------------
 
   3 - filter("SEXO"='H')
*/


--7
/*
Las diferencias se pueden observar en el plan de ejecucción de la segunda consulta, donde al crear el índice b-tree, este aparece en la columna "name",
y al crear el bitmap también, y aparece una fila más en el plan de ejecucción que corresponde al count y fullscan del bitmap.
*/


--8
exec dbms_stats.delete_index_stats( ownname=>'GIISGBD401', indname=>'IDX_SEXO', force=>true);
DROP INDEX IDX_SEXO;

--EJERCICIO 5

exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'ACTORES', cascade_columns=>true, cascade_indexes=>true, force=>true);
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'ACTUACION', cascade_columns=>true, cascade_indexes=>true, force=>true);
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'PELICULAS', cascade_columns=>true, cascade_indexes=>true, force=>true);

exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'ACTORES', cascade=>true, force=>true);
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'ACTUACION', cascade=>true, force=>true);
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'PELICULAS', cascade=>true, force=>true);

--1
EXPLAIN PLAN FOR 
SELECT A.NOM, A.SEXO
FROM GIISGBD.ACTORES_BASE A
WHERE EXISTS (
 SELECT *
 FROM GIISGBD.PELICULAS_BASE P,
 GIISGBD.ACTUACION_BASE ACT
 WHERE P.OID = ACT.PELI
 AND P.ANYO = 1980
 AND A.OID = ACT.ACTOR);


SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
---------------------------------------------------------------------------------------
| Id  | Operation            | Name           | Rows  | Bytes | Cost (%CPU)| Time     |
---------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT     |                | 19203 |  2287K|  7930   (1)| 00:00:01 |
|*  1 |  HASH JOIN RIGHT SEMI|                | 19203 |  2287K|  7930   (1)| 00:00:01 |
|   2 |   VIEW               | VW_SQ_1        | 19203 |   243K|  6530   (1)| 00:00:01 |
|*  3 |    HASH JOIN         |                | 19203 |   412K|  6530   (1)| 00:00:01 |
|*  4 |     TABLE ACCESS FULL| PELICULAS_BASE |  1869 | 18690 |  1193   (1)| 00:00:01 |
|   5 |     TABLE ACCESS FULL| ACTUACION_BASE |  1196K|    13M|  5334   (1)| 00:00:01 |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|   6 |   TABLE ACCESS FULL  | ACTORES_BASE   |   321K|    33M|  1399   (1)| 00:00:01 |
---------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   1 - access("A"."OID"="ITEM_1")
   3 - access("P"."OID"="ACT"."PELI")
   4 - filter("P"."ANYO"=1980)
 
Note

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-----
   - SQL plan baseline "SQL_PLAN_gx8r9y045r41w5fb64a4b" used for this statement

24 filas seleccionadas.
*/

EXPLAIN PLAN FOR 
SELECT A.NOM, A.SEXO
FROM GIISGBD.ACTORES_BASE A
WHERE A.OID IN (
 SELECT ACT.ACTOR
 FROM GIISGBD.PELICULAS_BASE P,
 GIISGBD.ACTUACION_BASE ACT
 WHERE P.OID = ACT.PELI
 AND P.ANYO = 1980);

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
---------------------------------------------------------------------------------------
| Id  | Operation            | Name           | Rows  | Bytes | Cost (%CPU)| Time     |
---------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT     |                | 19203 |  2287K|  7930   (1)| 00:00:01 |
|*  1 |  HASH JOIN RIGHT SEMI|                | 19203 |  2287K|  7930   (1)| 00:00:01 |
|   2 |   VIEW               | VW_NSO_1       | 19203 |   243K|  6530   (1)| 00:00:01 |
|*  3 |    HASH JOIN         |                | 19203 |   412K|  6530   (1)| 00:00:01 |
|*  4 |     TABLE ACCESS FULL| PELICULAS_BASE |  1869 | 18690 |  1193   (1)| 00:00:01 |
|   5 |     TABLE ACCESS FULL| ACTUACION_BASE |  1196K|    13M|  5334   (1)| 00:00:01 |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|   6 |   TABLE ACCESS FULL  | ACTORES_BASE   |   321K|    33M|  1399   (1)| 00:00:01 |
---------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   1 - access("A"."OID"="ACTOR")
   3 - access("P"."OID"="ACT"."PELI")
   4 - filter("P"."ANYO"=1980)

20 filas seleccionadas. 
*/

EXPLAIN PLAN FOR 
SELECT A.NOM, A.SEXO
FROM GIISGBD.ACTORES_BASE A
WHERE A.OID = ANY (
 SELECT ACT.ACTOR
 FROM GIISGBD.PELICULAS_BASE P,
 GIISGBD.ACTUACION_BASE ACT
 WHERE P.OID = ACT.PELI
 AND P.ANYO = 1980);


SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
---------------------------------------------------------------------------------------
| Id  | Operation            | Name           | Rows  | Bytes | Cost (%CPU)| Time     |
---------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT     |                | 19203 |  2287K|  7930   (1)| 00:00:01 |
|*  1 |  HASH JOIN RIGHT SEMI|                | 19203 |  2287K|  7930   (1)| 00:00:01 |
|   2 |   VIEW               | VW_NSO_1       | 19203 |   243K|  6530   (1)| 00:00:01 |
|*  3 |    HASH JOIN         |                | 19203 |   412K|  6530   (1)| 00:00:01 |
|*  4 |     TABLE ACCESS FULL| PELICULAS_BASE |  1869 | 18690 |  1193   (1)| 00:00:01 |
|   5 |     TABLE ACCESS FULL| ACTUACION_BASE |  1196K|    13M|  5334   (1)| 00:00:01 |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|   6 |   TABLE ACCESS FULL  | ACTORES_BASE   |   321K|    33M|  1399   (1)| 00:00:01 |
---------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   1 - access("A"."OID"="ACTOR")
   3 - access("P"."OID"="ACT"."PELI")
   4 - filter("P"."ANYO"=1980)

20 filas seleccionadas. 
*/

EXPLAIN PLAN FOR 
SELECT DISTINCT A.NOM, A.SEXO
FROM GIISGBD.PELICULAS_BASE P,
 GIISGBD.ACTUACION_BASE ACT, GIISGBD.ACTORES_BASE A
WHERE P.OID = ACT.PELI
 AND A.OID = ACT.ACTOR
 AND P.ANYO = 1980;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-----------------------------------------------------------------------------------------------
| Id  | Operation            | Name           | Rows  | Bytes |TempSpc| Cost (%CPU)| Time     |
-----------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT     |                | 19053 |  2437K|       |  8491   (1)| 00:00:01 |
|   1 |  HASH UNIQUE         |                | 19053 |  2437K|  2736K|  8491   (1)| 00:00:01 |
|*  2 |   HASH JOIN          |                | 19053 |  2437K|       |  7930   (1)| 00:00:01 |
|*  3 |    HASH JOIN         |                | 19203 |   412K|       |  6530   (1)| 00:00:01 |
|*  4 |     TABLE ACCESS FULL| PELICULAS_BASE |  1869 | 18690 |       |  1193   (1)| 00:00:01 |
|   5 |     TABLE ACCESS FULL| ACTUACION_BASE |  1196K|    13M|       |  5334   (1)| 00:00:01 |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|   6 |    TABLE ACCESS FULL | ACTORES_BASE   |   321K|    33M|       |  1399   (1)| 00:00:01 |
-----------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   2 - access("A"."OID"="ACT"."ACTOR")
   3 - access("P"."OID"="ACT"."PELI")
   4 - filter("P"."ANYO"=1980)
 
Note

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-----
   - this is an adaptive plan

24 filas seleccionadas. 
*/


/*
En la última consulta no aparece la operación "view", pero aún así cuenta con el mismo número de operaciones que las otras consultas. 
Esto se debe al uso de distinct, que crea la operación hash unique.
*/

--2
EXPLAIN PLAN FOR 
SELECT A.NOM, A.SEXO
FROM GIISGBD.ACTORES_BASE A
WHERE EXISTS (
 SELECT *
 FROM GIISGBD.PELICULAS_BASE P,
 GIISGBD.ACTUACION_BASE ACT
 WHERE P.OID = ACT.PELI
 AND P.ANYO = 2000
 AND A.OID = ACT.ACTOR);


SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-----------------------------------------------------------------------------------------------
| Id  | Operation                    | Name           | Rows  | Bytes | Cost (%CPU)| Time     |
-----------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT             |                |    26 |  3172 |  6557   (1)| 00:00:01 |
|   1 |  NESTED LOOPS                |                |    26 |  3172 |  6557   (1)| 00:00:01 |
|   2 |   NESTED LOOPS               |                |    26 |  3172 |  6557   (1)| 00:00:01 |
|   3 |    VIEW                      | VW_SQ_1        |    26 |   338 |  6530   (1)| 00:00:01 |
|   4 |     HASH UNIQUE              |                |    26 |   572 |            |          |
|*  5 |      HASH JOIN               |                |    26 |   572 |  6530   (1)| 00:00:01 |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|*  6 |       TABLE ACCESS FULL      | PELICULAS_BASE |     3 |    30 |  1193   (1)| 00:00:01 |
|   7 |       TABLE ACCESS FULL      | ACTUACION_BASE |  1196K|    13M|  5334   (1)| 00:00:01 |
|*  8 |    INDEX UNIQUE SCAN         | SYS_C0013134   |     1 |       |     0   (0)| 00:00:01 |
|   9 |   TABLE ACCESS BY INDEX ROWID| ACTORES_BASE   |     1 |   109 |     1   (0)| 00:00:01 |
-----------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   5 - access("P"."OID"="ACT"."PELI")
   6 - filter("P"."ANYO"=2000)

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   8 - access("A"."OID"="ITEM_1")
 
Note
-----
   - this is an adaptive plan

27 filas seleccionadas.
*/

EXPLAIN PLAN FOR 
SELECT A.NOM, A.SEXO
FROM GIISGBD.ACTORES_BASE A
WHERE A.OID IN (
 SELECT ACT.ACTOR
 FROM GIISGBD.PELICULAS_BASE P,
 GIISGBD.ACTUACION_BASE ACT
 WHERE P.OID = ACT.PELI
 AND P.ANYO = 2000);

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-----------------------------------------------------------------------------------------------
| Id  | Operation                    | Name           | Rows  | Bytes | Cost (%CPU)| Time     |
-----------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT             |                |    26 |  3172 |  6557   (1)| 00:00:01 |
|   1 |  NESTED LOOPS                |                |    26 |  3172 |  6557   (1)| 00:00:01 |
|   2 |   NESTED LOOPS               |                |    26 |  3172 |  6557   (1)| 00:00:01 |
|   3 |    VIEW                      | VW_NSO_1       |    26 |   338 |  6530   (1)| 00:00:01 |
|   4 |     HASH UNIQUE              |                |    26 |   572 |            |          |
|*  5 |      HASH JOIN               |                |    26 |   572 |  6530   (1)| 00:00:01 |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|*  6 |       TABLE ACCESS FULL      | PELICULAS_BASE |     3 |    30 |  1193   (1)| 00:00:01 |
|   7 |       TABLE ACCESS FULL      | ACTUACION_BASE |  1196K|    13M|  5334   (1)| 00:00:01 |
|*  8 |    INDEX UNIQUE SCAN         | SYS_C0013134   |     1 |       |     0   (0)| 00:00:01 |
|   9 |   TABLE ACCESS BY INDEX ROWID| ACTORES_BASE   |     1 |   109 |     1   (0)| 00:00:01 |
-----------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   5 - access("P"."OID"="ACT"."PELI")
   6 - filter("P"."ANYO"=2000)

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   8 - access("A"."OID"="ACTOR")
 
Note
-----
   - this is an adaptive plan

27 filas seleccionadas. 
*/

EXPLAIN PLAN FOR 
SELECT A.NOM, A.SEXO
FROM GIISGBD.ACTORES_BASE A
WHERE A.OID = ANY (
 SELECT ACT.ACTOR
 FROM GIISGBD.PELICULAS_BASE P,
 GIISGBD.ACTUACION_BASE ACT
 WHERE P.OID = ACT.PELI
 AND P.ANYO = 2000);


SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-----------------------------------------------------------------------------------------------
| Id  | Operation                    | Name           | Rows  | Bytes | Cost (%CPU)| Time     |
-----------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT             |                |    26 |  3172 |  6557   (1)| 00:00:01 |
|   1 |  NESTED LOOPS                |                |    26 |  3172 |  6557   (1)| 00:00:01 |
|   2 |   NESTED LOOPS               |                |    26 |  3172 |  6557   (1)| 00:00:01 |
|   3 |    VIEW                      | VW_NSO_1       |    26 |   338 |  6530   (1)| 00:00:01 |
|   4 |     HASH UNIQUE              |                |    26 |   572 |            |          |
|*  5 |      HASH JOIN               |                |    26 |   572 |  6530   (1)| 00:00:01 |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|*  6 |       TABLE ACCESS FULL      | PELICULAS_BASE |     3 |    30 |  1193   (1)| 00:00:01 |
|   7 |       TABLE ACCESS FULL      | ACTUACION_BASE |  1196K|    13M|  5334   (1)| 00:00:01 |
|*  8 |    INDEX UNIQUE SCAN         | SYS_C0013134   |     1 |       |     0   (0)| 00:00:01 |
|   9 |   TABLE ACCESS BY INDEX ROWID| ACTORES_BASE   |     1 |   109 |     1   (0)| 00:00:01 |
-----------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   5 - access("P"."OID"="ACT"."PELI")
   6 - filter("P"."ANYO"=2000)

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   8 - access("A"."OID"="ACTOR")
 
Note
-----
   - this is an adaptive plan

27 filas seleccionadas. 
*/

EXPLAIN PLAN FOR 
SELECT DISTINCT A.NOM, A.SEXO
FROM GIISGBD.PELICULAS_BASE P,
 GIISGBD.ACTUACION_BASE ACT, GIISGBD.ACTORES_BASE A
WHERE P.OID = ACT.PELI
 AND A.OID = ACT.ACTOR
 AND P.ANYO = 2000;

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
------------------------------------------------------------------------------------------------
| Id  | Operation                     | Name           | Rows  | Bytes | Cost (%CPU)| Time     |
------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT              |                |    25 |  3275 |  6557   (1)| 00:00:01 |
|   1 |  HASH UNIQUE                  |                |    25 |  3275 |  6557   (1)| 00:00:01 |
|   2 |   NESTED LOOPS                |                |    25 |  3275 |  6556   (1)| 00:00:01 |
|   3 |    NESTED LOOPS               |                |    26 |  3275 |  6556   (1)| 00:00:01 |
|*  4 |     HASH JOIN                 |                |    26 |   572 |  6530   (1)| 00:00:01 |
|*  5 |      TABLE ACCESS FULL        | PELICULAS_BASE |     3 |    30 |  1193   (1)| 00:00:01 |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|   6 |      TABLE ACCESS FULL        | ACTUACION_BASE |  1196K|    13M|  5334   (1)| 00:00:01 |
|*  7 |     INDEX UNIQUE SCAN         | SYS_C0013134   |     1 |       |     0   (0)| 00:00:01 |
|   8 |    TABLE ACCESS BY INDEX ROWID| ACTORES_BASE   |     1 |   109 |     1   (0)| 00:00:01 |
------------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   4 - access("P"."OID"="ACT"."PELI")
   5 - filter("P"."ANYO"=2000)
   7 - access("A"."OID"="ACT"."ACTOR")

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
Note
-----
   - this is an adaptive plan

26 filas seleccionadas. 
*/

/*
En el último plan se realizan casi las mismas operaciones que en los otros, pero en un orden diferente, menos "view", que en la última consulta
hace un "table access full".
Al cambiar el valor de 1980 a 2000 se puede observar que se empiezan a utilizar índices en los planes de ejecucción.
Esto se debe a la diferencia en la cantidad de valores que tienen el atributo anyo igual a cada valor, por ejemplo, si se hace un count para la última consulta
utilizando 1980 se obtiene 17683, mientras que si se utiliza 2000, se obtiene 5.
*/

--EJERCICIO 6
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'ACTORES', cascade_columns=>true, cascade_indexes=>true, force=>true);
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'ACTUACION', cascade_columns=>true, cascade_indexes=>true, force=>true);
exec dbms_stats.delete_table_stats( ownname=>'GIISGBD401', tabname=>'PELICULAS', cascade_columns=>true, cascade_indexes=>true, force=>true);

exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'ACTORES', cascade=>true, force=>true);
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'ACTUACION', cascade=>true, force=>true);
exec dbms_stats.gather_table_stats( ownname=>'GIISGBD401', tabname=>'PELICULAS', cascade=>true, force=>true);

--1
EXPLAIN PLAN FOR 
SELECT A.NOM, P.TITULO, ACT.PAPEL, P.ANYO
FROM ACTORES A, PELICULAS P, ACTUACION ACT
WHERE A.OID = ACT.ACTOR
 AND P.OID = ACT.PELI
 AND SEXO = 'H'
 AND P.TITULO LIKE 'Lost%';

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
---------------------------------------------------------------------------------------------
| Id  | Operation                    | Name         | Rows  | Bytes | Cost (%CPU)| Time     |
---------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT             |              |     7 |  3003 |    27   (0)| 00:00:01 |
|   1 |  NESTED LOOPS                |              |     7 |  3003 |    27   (0)| 00:00:01 |
|   2 |   NESTED LOOPS               |              |    12 |  3003 |    27   (0)| 00:00:01 |
|*  3 |    HASH JOIN                 |              |    12 |  3852 |    15   (0)| 00:00:01 |
|*  4 |     TABLE ACCESS FULL        | PELICULAS    |     1 |   210 |     3   (0)| 00:00:01 |
|   5 |     INDEX FAST FULL SCAN     | SYS_C0067129 |  2500 |   270K|    12   (0)| 00:00:01 |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|*  6 |    INDEX UNIQUE SCAN         | SYS_C0067121 |     1 |       |     0   (0)| 00:00:01 |
|*  7 |   TABLE ACCESS BY INDEX ROWID| ACTORES      |     1 |   108 |     1   (0)| 00:00:01 |
---------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   3 - access("P"."OID"="ACT"."PELI")
   4 - filter("P"."TITULO" LIKE 'Lost%')
   6 - access("A"."OID"="ACT"."ACTOR")
   7 - filter("SEXO"='H')

22 filas seleccionadas. 
*/

EXPLAIN PLAN FOR 
SELECT A.NOM, P.TITULO, ACT.PAPEL, P.ANYO 
FROM GIISGBD.ACTORES_BASE A, GIISGBD.PELICULAS_BASE P, GIISGBD.ACTUACION_BASE ACT 
WHERE A.OID = ACT.ACTOR AND P.OID = ACT.PELI AND SEXO = 'H' AND P.TITULO LIKE 'Lost%';

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
---------------------------------------------------------------------------------------------------------
| Id  | Operation                              | Name           | Rows  | Bytes | Cost (%CPU)| Time     |
---------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                       |                |     7 |  3017 |  5354   (1)| 00:00:01 |
|   1 |  NESTED LOOPS                          |                |     7 |  3017 |  5354   (1)| 00:00:01 |
|   2 |   NESTED LOOPS                         |                |    11 |  3017 |  5354   (1)| 00:00:01 |
|*  3 |    HASH JOIN                           |                |    11 |  3542 |  5343   (1)| 00:00:01 |
|   4 |     TABLE ACCESS BY INDEX ROWID BATCHED| PELICULAS_BASE |     1 |   210 |     5   (0)| 00:00:01 |
|*  5 |      INDEX RANGE SCAN                  | IDX_TITULO     |     1 |       |     3   (0)| 00:00:01 |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|   6 |     TABLE ACCESS FULL                  | ACTUACION_BASE |  1196K|   127M|  5335   (1)| 00:00:01 |
|*  7 |    INDEX UNIQUE SCAN                   | SYS_C0013134   |     1 |       |     0   (0)| 00:00:01 |
|*  8 |   TABLE ACCESS BY INDEX ROWID          | ACTORES_BASE   |     1 |   109 |     1   (0)| 00:00:01 |
---------------------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   3 - access("P"."OID"="ACT"."PELI")
   5 - access("P"."TITULO" LIKE 'Lost%')
       filter("P"."TITULO" LIKE 'Lost%')

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   7 - access("A"."OID"="ACT"."ACTOR")
   8 - filter("SEXO"='H')

24 filas seleccionadas. 
*/

EXPLAIN PLAN FOR 
SELECT A.NOM, P.TITULO, ACT.PAPEL, P.ANYO 
FROM GIISGBD.ACTORES_BASE A, GIISGBD.PELICULAS_BASE P, GIISGBD.ACTUACION_BASE ACT 
WHERE A.OID = ACT.ACTOR AND P.OID = ACT.PELI AND SEXO = 'H' AND P.TITULO LIKE '%Empire%';

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
----------------------------------------------------------------------------------------------
| Id  | Operation           | Name           | Rows  | Bytes |TempSpc| Cost (%CPU)| Time     |
----------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT    |                | 45673 |    18M|       | 10245   (1)| 00:00:01 |
|*  1 |  HASH JOIN          |                | 45673 |    18M|    23M| 10245   (1)| 00:00:01 |
|*  2 |   HASH JOIN         |                | 73115 |    22M|       |  6531   (1)| 00:00:01 |
|*  3 |    TABLE ACCESS FULL| PELICULAS_BASE |  7116 |  1459K|       |  1193   (1)| 00:00:01 |
|   4 |    TABLE ACCESS FULL| ACTUACION_BASE |  1196K|   127M|       |  5335   (1)| 00:00:01 |
|*  5 |   TABLE ACCESS FULL | ACTORES_BASE   |   202K|    21M|       |  1401   (1)| 00:00:01 |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   1 - access("A"."OID"="ACT"."ACTOR")
   2 - access("P"."OID"="ACT"."PELI")
   3 - filter("P"."TITULO" LIKE '%Empire%')
   5 - filter("SEXO"='H')
 
Note

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-----
   - this is an adaptive plan

24 filas seleccionadas.
*/

--2
--Hay que crear índices
--create table peliculas_base as select * from GIISGBD.PELICULAS_BASE;
--create table actores_base as select * from GIISGBD.ACTORES_BASE;
--create table actuacion_base as select * from GIISGBD.ACTUACION_BASE;
--+ añadir claves primarias

CREATE BITMAP INDEX IDX_SEXO ON ACTORES(SEXO);
exec dbms_stats.gather_index_stats( ownname=>'GIISGBD401', indname=>'IDX_SEXO', force =>true);

CREATE INDEX IDX_TITULO ON PELICULAS(TITULO);
exec dbms_stats.gather_index_stats( ownname=>'GIISGBD401', indname=>'IDX_TITULO', force =>true);

--drop index IDX_SEXO;
--drop index IDX_TITULO;

EXPLAIN PLAN FOR 
SELECT A.NOM, P.TITULO, ACT.PAPEL, P.ANYO
FROM ACTORES A, PELICULAS P, ACTUACION ACT
WHERE A.OID = ACT.ACTOR
 AND P.OID = ACT.PELI
 AND SEXO = 'H'
 AND P.TITULO LIKE 'Lost%';

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
-------------------------------------------------------------------------------------------------------
| Id  | Operation                              | Name         | Rows  | Bytes | Cost (%CPU)| Time     |
-------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                       |              |     7 |  3003 |    27   (0)| 00:00:01 |
|   1 |  NESTED LOOPS                          |              |     7 |  3003 |    27   (0)| 00:00:01 |
|   2 |   NESTED LOOPS                         |              |    12 |  3003 |    27   (0)| 00:00:01 |
|*  3 |    HASH JOIN                           |              |    12 |  3852 |    15   (0)| 00:00:01 |
|   4 |     TABLE ACCESS BY INDEX ROWID BATCHED| PELICULAS    |     1 |   210 |     3   (0)| 00:00:01 |
|*  5 |      INDEX RANGE SCAN                  | IDX_TITULO   |     1 |       |     2   (0)| 00:00:01 |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|   6 |     INDEX FAST FULL SCAN               | SYS_C0067129 |  2500 |   270K|    12   (0)| 00:00:01 |
|*  7 |    INDEX UNIQUE SCAN                   | SYS_C0067121 |     1 |       |     0   (0)| 00:00:01 |
|*  8 |   TABLE ACCESS BY INDEX ROWID          | ACTORES      |     1 |   108 |     1   (0)| 00:00:01 |
-------------------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   3 - access("P"."OID"="ACT"."PELI")
   5 - access("P"."TITULO" LIKE 'Lost%')
       filter("P"."TITULO" LIKE 'Lost%')

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
   7 - access("A"."OID"="ACT"."ACTOR")
   8 - filter("SEXO"='H')

24 filas seleccionadas. 
*/

CREATE BITMAP INDEX IDX_SEXO_BASE ON actores_base(SEXO);
exec dbms_stats.gather_index_stats( ownname=>'GIISGBD401', indname=>'IDX_SEXO_BASE', force =>true);

CREATE INDEX IDX_TITULO_BASE ON peliculas_base(TITULO);
exec dbms_stats.gather_index_stats( ownname=>'GIISGBD401', indname=>'IDX_TITULO_BASE', force =>true);

EXPLAIN PLAN FOR 
SELECT A.NOM, P.TITULO, ACT.PAPEL, P.ANYO 
FROM ACTORES_BASE A, PELICULAS_BASE P, ACTUACION_BASE ACT 
WHERE A.OID = ACT.ACTOR AND P.OID = ACT.PELI AND SEXO = 'H' AND P.TITULO LIKE 'Lost%';

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
---------------------------------------------------------------------------------------------------------
| Id  | Operation                             | Name            | Rows  | Bytes | Cost (%CPU)| Time     |
---------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                      |                 |     6 |  2586 |  6745   (1)| 00:00:01 |
|*  1 |  HASH JOIN                            |                 |     6 |  2586 |  6745   (1)| 00:00:01 |
|*  2 |   HASH JOIN                           |                 |    11 |  3542 |  5344   (1)| 00:00:01 |
|   3 |    TABLE ACCESS BY INDEX ROWID BATCHED| PELICULAS_BASE  |     1 |   210 |     5   (0)| 00:00:01 |
|*  4 |     INDEX RANGE SCAN                  | IDX_TITULO_BASE |     1 |       |     3   (0)| 00:00:01 |
|   5 |    TABLE ACCESS FULL                  | ACTUACION_BASE  |  1196K|   127M|  5336   (1)| 00:00:01 |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
|*  6 |   TABLE ACCESS FULL                   | ACTORES_BASE    |   160K|    16M|  1401   (1)| 00:00:01 |
---------------------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   1 - access("A"."OID"="ACT"."ACTOR")
   2 - access("P"."OID"="ACT"."PELI")
   4 - access("P"."TITULO" LIKE 'Lost%')
       filter("P"."TITULO" LIKE 'Lost%')
   6 - filter("SEXO"='H')

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
 
Note
-----
   - SQL plan baseline "SQL_PLAN_7mvm5unxcdxwk21634f54" used for this statement

26 filas seleccionadas. 
*/

EXPLAIN PLAN FOR 
SELECT A.NOM, P.TITULO, ACT.PAPEL, P.ANYO 
FROM GIISGBD.ACTORES_BASE A, GIISGBD.PELICULAS_BASE P, GIISGBD.ACTUACION_BASE ACT 
WHERE A.OID = ACT.ACTOR AND P.OID = ACT.PELI AND SEXO = 'H' AND P.TITULO LIKE '%Empire%';

SELECT * FROM TABLE(DBMS_XPLAN.DISPLAY);
/*
----------------------------------------------------------------------------------------------
| Id  | Operation           | Name           | Rows  | Bytes |TempSpc| Cost (%CPU)| Time     |
----------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT    |                | 45673 |    18M|       | 10245   (1)| 00:00:01 |
|*  1 |  HASH JOIN          |                | 45673 |    18M|    23M| 10245   (1)| 00:00:01 |
|*  2 |   HASH JOIN         |                | 73115 |    22M|       |  6531   (1)| 00:00:01 |
|*  3 |    TABLE ACCESS FULL| PELICULAS_BASE |  7116 |  1459K|       |  1193   (1)| 00:00:01 |
|   4 |    TABLE ACCESS FULL| ACTUACION_BASE |  1196K|   127M|       |  5335   (1)| 00:00:01 |
|*  5 |   TABLE ACCESS FULL | ACTORES_BASE   |   202K|    21M|       |  1401   (1)| 00:00:01 |

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
----------------------------------------------------------------------------------------------
 
Predicate Information (identified by operation id):
---------------------------------------------------
 
   1 - access("A"."OID"="ACT"."ACTOR")
   2 - access("P"."OID"="ACT"."PELI")
   3 - filter("P"."TITULO" LIKE '%Empire%')
   5 - filter("SEXO"='H')
 
Note

PLAN_TABLE_OUTPUT
----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-----
   - this is an adaptive plan

24 filas seleccionadas. 
*/


/*
En la primera consulta se añaden dos indices, por sexo y por titulo, pero solo se utiliza el indice por titulo en el plan de ejecuccion.
Si se cuenta el nº de actores con sexo H (SELECT COUNT(*) FROM ACTORES WHERE SEXO = 'H';) se obtienen 1382.

La segunda y tercera consulta se realizan sobre las tablas copiadas, "_base".

En la segunda consulta se utiliza el índice de título, pero no el de sexo.

En la última consulta no se utiliza ninguno de los índices creados, ya que al utilizar "LIKE" no sería eficiente, sin embargo en la consulta 2
si que se utiliza porque es más eficiente.
*/

--drop table actores_base;
--drop table actuacion_base;
--drop table peliculas_base;