 ---------------------------Práctica 4---------------------------

--EJERCICIO 2
--Transacción #2.1
SET TRANSACTION READ WRITE;
INSERT INTO DEPT VALUES (60, 'PRUEBAS', 'NEW YORK');

SAVEPOINT sp1;

INSERT INTO EMP VALUES(9061, 'Gabriel', 'CEO', 6666, '02/12/99', 9999, 666, 60);
INSERT INTO EMP VALUES(9062, 'Sara', 'Vice-CEO', 6665, '04/08/97', 9999, 666, 60);
INSERT INTO DEPT VALUES (70, 'TEST', 'TORONTO');

SAVEPOINT sp2;

INSERT INTO EMP VALUES(9071, 'María', 'Cafés', 1234, '01/02/03', 1234, 666, 70);
INSERT INTO EMP VALUES(9071, 'Marta', 'Limpieza', 4321, '03/02/01', 4321, 666, 70);  --ERROR POR CLAVE PRIMARIA, USA LA MISMA QUE EL EMPLEADO RECIÉN INSERTADO

ROLLBACK TO sp2; --DESAPARCE EL EMPLEADO INSERTADO

INSERT INTO EMP VALUES(9071, 'María', 'Cafés', 1234, '01/02/03', 1234, 666, 70); 
--NO DA ERROR POR CLAVE PRIMARIA PORQUE EL QUE SE HABÍA PUESTO ANTES CON LA MISMA CLAVE HA SIDO ELIMINADO EN EL ROLLBACK

ROLLBACK TO sp1; --DESAPARECEN TODOS LOS EMPLEADOS PUESTOS Y EL DEPT 70

INSERT INTO EMP VALUES(9071, 'María', 'Cafés', 1234, '01/02/03', 1234, 666, 70); --ERROR PORQUE NO HAY DEPT 70

COMMIT;